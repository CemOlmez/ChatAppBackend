<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SignalR Tester</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
</head>
<body>
  <h2>SignalR Chat Tester</h2>
  <button onclick="connect()">Connect</button>
  <button onclick="joinGroup()">Join Group</button>
  <div id="messages" style="margin-top: 20px; font-family: monospace;"></div>


  <input id="messageInput" type="text" placeholder="Type a message..." />
<button onclick="sendGroupMessage()">Send to Group</button>
  <script>
    const groupId = "01982452-6f06-72d9-b807-24a4ed7dd6ce"; // Replace with actual groupId
    const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1laWQiOiIwMTk4MGYwNS1iZTU2LTc5ZTYtODA2YS01MDhiYTZhODdkMjciLCJ1bmlxdWVfbmFtZSI6IkpvaG5Eb2UiLCJlbWFpbCI6IkpvaG5Eb2VAZ21haWwuY29tIiwibmJmIjoxNzUyOTU5NzUzLCJleHAiOjE3NTI5NjA2NTMsImlhdCI6MTc1Mjk1OTc1MywiaXNzIjoieW91cmFwcC5jb20iLCJhdWQiOiJ5b3VyYXBwLmNvbSJ9.SQxWRcAGIGeglCaYewgiaqkm-cNJ7elK16Ee6-VA2Ug"; // Replace with actual token

    const connection = new signalR.HubConnectionBuilder()
      .withUrl("https://localhost:7180/chatHub", {
        accessTokenFactory: () => token
      })
      .configureLogging(signalR.LogLevel.Information)
      .build();

    connection.on("ReceiveGroupMessage", (message) => {
      const el = document.getElementById("messages");
      el.innerHTML += `<p><strong>Group:</strong> ${message.content}</p>`;
    });

    connection.on("ReceiveDirectMessage", (message) => {
      const el = document.getElementById("messages");
      el.innerHTML += `<p><strong>DM:</strong> ${message.content}</p>`;
    });

    async function connect() {
      await connection.start();
      alert("Connected!");
    }

    async function joinGroup() {
      await connection.invoke("JoinGroup", groupId);
      alert("Joined Group: " + groupId);
    }

    function sendGroupMessage() {
  const content = document.getElementById("messageInput").value;

  const message = {
    groupId: groupId, // Uses the one from the top
    content: content,
    fileUrl: null,
    receiverId: null
  };

  connection.invoke("SendMessageToGroup", message)
    .then(() => console.log("Group message sent"))
    .catch(err => console.error("Error sending group message", err));
}


  </script>
</body>
</html>
